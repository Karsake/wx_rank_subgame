require=function r(o,c,l){function s(a,e){if(!c[a]){if(!o[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(g)return g(a,!0);var n=new Error("Cannot find module '"+a+"'");throw n.code="MODULE_NOT_FOUND",n}var i=c[a]={exports:{}};o[a][0].call(i.exports,function(e){return s(o[a][1][e]||e)},i,i.exports,r,o,c,l)}return c[a].exports}for(var g="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({GameOverRank:[function(e,a,t){"use strict";cc._RF.push(a,"d97bdIn/jtJmpn7qz0kKhI5","GameOverRank"),cc.Class({extends:cc.Component,name:"GameOverRank",properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label},init:function(e,a,t){var n=a.avatarUrl,i=a.nickname,r=0!=a.KVDataList.length?a.KVDataList[0].value:0;e%2==0&&(this.backSprite.color=new cc.Color(255,255,255,255)),t&&(this.rankLabel.node.color=new cc.Color(0,255,0,255)),this.rankLabel.string=(e+1).toString(),this.createImage(n),this.nickLabel.string=i,this.topScoreLabel.string=r.toString()},createImage:function(e){var t=this;if(null!=window.wx)try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.avatarImgSprite.node.active=!1}},a.src=e}catch(e){cc.log(e),this.avatarImgSprite.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,a){t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(a)})}}),cc._RF.pop()},{}],GameRankingList:[function(e,a,t){"use strict";cc._RF.push(a,"a0ea2Faum1JDKkSr0Ka631L","GameRankingList"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab,prefabGameOverRank:cc.Prefab,gameOverRankLayout:cc.Node,loadingLabel:cc.Node},start:function(){var a=this;this.removeChild(),null!=window.wx?window.wx.onMessage(function(e){cc.log("接收主域发来消息：",e),0==e.messageType?a.removeChild():1==e.messageType?a.fetchFriendData(e.MAIN_MENU_NUM):3==e.messageType?a.submitScore(e.MAIN_MENU_NUM,e.score):4==e.messageType?a.gameOverRank(e.MAIN_MENU_NUM):5==e.messageType&&a.fetchGroupFriendData(e.MAIN_MENU_NUM,e.shareTicket)}):this.fetchFriendData(1e3)},submitScore:function(a,t){null!=window.wx?window.wx.getUserCloudStorage({keyList:[a],success:function(e){console.log("getUserCloudStorage","success",e),0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:a,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}}):cc.log("提交得分:"+a+" : "+t)},removeChild:function(){this.node.removeChildByTag(1e3),this.rankingScrollView.node.active=!1,this.scrollViewContent.removeAllChildren(),this.gameOverRankLayout.active=!1,this.gameOverRankLayout.removeAllChildren(),this.loadingLabel.string="玩命加载中...",this.loadingLabel.active=!0},fetchFriendData:function(a){var c=this;this.removeChild(),this.rankingScrollView.node.active=!0,null!=window.wx&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){c.loadingLabel.active=!1,console.log("success",e.data);var o=e.data[0];wx.getFriendCloudStorage({keyList:[a],success:function(e){console.log("wx.getFriendCloudStorage success",e);var a=e.data;a.sort(function(e,a){return 0==e.KVDataList.length&&0==a.KVDataList.length?0:0==e.KVDataList.length?1:0==a.KVDataList.length?-1:a.KVDataList[0].value-e.KVDataList[0].value});for(var t=0;t<a.length;t++){var n=a[t],i=cc.instantiate(c.prefabRankItem);if(i.getComponent("RankItem").init(t,n),c.scrollViewContent.addChild(i),a[t].avatarUrl==o.avatarUrl){var r=cc.instantiate(c.prefabRankItem);r.getComponent("RankItem").init(t,n),r.y=-354,c.node.addChild(r,1,1e3)}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),c.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){c.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fetchGroupFriendData:function(a,t){var c=this;this.removeChild(),this.rankingScrollView.node.active=!0,null!=window.wx&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);var o=e.data[0];wx.getGroupCloudStorage({shareTicket:t,keyList:[a],success:function(e){console.log("wx.getGroupCloudStorage success",e),c.loadingLabel.active=!1;var a=e.data;a.sort(function(e,a){return 0==e.KVDataList.length&&0==a.KVDataList.length?0:0==e.KVDataList.length?1:0==a.KVDataList.length?-1:a.KVDataList[0].value-e.KVDataList[0].value});for(var t=0;t<a.length;t++){var n=a[t],i=cc.instantiate(c.prefabRankItem);if(i.getComponent("RankItem").init(t,n),c.scrollViewContent.addChild(i),a[t].avatarUrl==o.avatarUrl){var r=cc.instantiate(c.prefabRankItem);r.getComponent("RankItem").init(t,n),r.y=-354,c.node.addChild(r,1,1e3)}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),c.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){c.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},gameOverRank:function(a){var g=this;this.removeChild(),this.gameOverRankLayout.active=!0,null!=window.wx&&wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){cc.log("success",e.data);var s=e.data[0];wx.getFriendCloudStorage({keyList:[a],success:function(e){cc.log("wx.getFriendCloudStorage success",e),g.loadingLabel.active=!1;var a=e.data;a.sort(function(e,a){return 0==e.KVDataList.length&&0==a.KVDataList.length?0:0==e.KVDataList.length?1:0==a.KVDataList.length?-1:a.KVDataList[0].value-e.KVDataList[0].value});for(var t=0;t<a.length;t++)if(a[t].avatarUrl==s.avatarUrl){if(0<=t-1){if(t+1>=a.length&&0<=t-2){var n=cc.instantiate(g.prefabGameOverRank);n.getComponent("GameOverRank").init(t-2,a[t-2]),g.gameOverRankLayout.addChild(n)}var i=cc.instantiate(g.prefabGameOverRank);i.getComponent("GameOverRank").init(t-1,a[t-1]),g.gameOverRankLayout.addChild(i)}else if(t+2>=a.length){var r=new cc.Node;r.width=200,g.gameOverRankLayout.addChild(r)}var o=cc.instantiate(g.prefabGameOverRank);if(o.getComponent("GameOverRank").init(t,a[t],!0),g.gameOverRankLayout.addChild(o),t+1<a.length){var c=cc.instantiate(g.prefabGameOverRank);if(c.getComponent("GameOverRank").init(t+1,a[t+1]),g.gameOverRankLayout.addChild(c),t-1<0&&t+2<a.length){var l=cc.instantiate(g.prefabGameOverRank);l.getComponent("GameOverRank").init(t+2,a[t+2]),g.gameOverRankLayout.addChild(l)}}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),g.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){g.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})}}),cc._RF.pop()},{}],RankItem:[function(e,a,t){"use strict";cc._RF.push(a,"dd553fmL+BGfJ9idSJ4ApIP","RankItem"),cc.Class({extends:cc.Component,name:"RankItem",properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label,crownImage:cc.Node},start:function(){},init:function(e,a){var t=a.avatarUrl,n=a.nickname,i=0!=a.KVDataList.length?a.KVDataList[0].value:0;e<3&&(this.crownImage.active=!0,this.rankLabel.node.color=new cc.Color(0,0,0,255)),this.rankLabel.string=(e+1).toString(),this.createImage(t),this.nickLabel.string=n,this.topScoreLabel.string="第"+i.toString()+"关"},createImage:function(e){var t=this;if(null!=window.wx)try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.avatarImgSprite.node.active=!1}},a.src=e}catch(e){cc.log(e),this.avatarImgSprite.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,a){t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(a)})}}),cc._RF.pop()},{}]},{},["GameOverRank","GameRankingList","RankItem"]);